<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Junte-se a uma comunidade</title>
    <script>
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      const communityId = getQueryParam('id');

      if (communityId) {
        const deepLink = `bwepo://infocomunidades/${communityId}`;
        const androidStore = 'https://play.google.com/store/apps/details?id=com.matheusener.bwepo';
        const iosStore = 'https://apps.apple.com/br/app/bwepo/id6743187782';

        const isAndroid = /android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

        if (isAndroid) {
          // Android pode redirecionar direto
          window.location.href = deepLink;
          setTimeout(() => {
            window.location.href = androidStore;
          }, 2000);
        } else if (isIOS) {
          // iOS: tenta abrir via iframe (para contornar o bloqueio)
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = deepLink;
          document.body.appendChild(iframe);

          setTimeout(() => {
            window.location.href = iosStore;
          }, 2000);
        } else {
          document.body.innerHTML = "<p>Por favor, abra este link em um dispositivo móvel.</p>";
        }
      } else {
        document.write('<p>Erro: Comunidade não encontrada. Verifique o link.</p>');
      }
    </script>
  </head>
  <body>
    <p>Redirecionando para a comunidade no app...</p>
  </body>
</html>
